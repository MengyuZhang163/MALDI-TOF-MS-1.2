# 🎯 MALDI-TOF MS 模版化处理平台 - 完整部署包

## 📦 需要上传到GitHub的文件（5个）

### ✅ 必需文件清单

| 文件名 | 说明 | 必需性 |
|--------|------|--------|
| **app.py** | Streamlit主应用程序 | ⭐⭐⭐ 必需 |
| **requirements.txt** | Python依赖包 | ⭐⭐⭐ 必需 |
| **packages.txt** | 系统依赖（R环境） | ⭐⭐⭐ 必需 |
| **install_r_packages.R** | R包安装脚本 | ⭐⭐⭐ 必需 |
| **README.md** | 项目说明文档 | ⭐⭐ 推荐 |

---

## 📂 GitHub仓库结构

```
你的仓库名/
├── app.py                    ← 主程序
├── requirements.txt          ← Python依赖
├── packages.txt              ← 系统依赖
├── install_r_packages.R      ← R包安装
└── README.md                 ← 说明文档
```

---

## 🚀 快速部署步骤

### 步骤1: 创建GitHub仓库

1. 登录 https://github.com
2. 点击 "+" → "New repository"
3. 仓库名: `maldi-tof-template`（或其他名字）
4. 选择 **Public**
5. 勾选 "Add a README file"
6. 点击 "Create repository"

### 步骤2: 上传文件

#### 方法A: 网页上传（推荐）

1. 点击 "Add file" → "Upload files"
2. 拖拽这5个文件：
   - app.py
   - requirements.txt
   - packages.txt
   - install_r_packages.R
   - README.md（如果创建仓库时没勾选）
3. 提交信息: "Add application files"
4. 点击 "Commit changes"

#### 方法B: Git命令行

```bash
git clone https://github.com/你的用户名/maldi-tof-template.git
cd maldi-tof-template

# 复制这5个文件到目录
cp /path/to/app.py .
cp /path/to/requirements.txt .
cp /path/to/packages.txt .
cp /path/to/install_r_packages.R .
cp /path/to/README.md .

git add .
git commit -m "Add MALDI-TOF MS template processing app"
git push
```

### 步骤3: 部署到Streamlit Cloud

1. 访问 https://share.streamlit.io/
2. 使用GitHub账号登录
3. 点击 "New app"
4. 填写：
   - **Repository**: `你的用户名/maldi-tof-template`
   - **Branch**: `main`
   - **Main file path**: `app.py`
5. 点击 "Deploy!"
6. 等待5-10分钟（首次部署需要安装R）

---

## 📋 文件内容说明

### 1. app.py
- **大小**: ~6KB
- **内容**: Streamlit网页应用主程序
- **功能**: 
  - 提供网页界面
  - 处理文件上传
  - 调用R脚本进行数据处理

### 2. requirements.txt
- **大小**: 62字节
- **内容**:
  ```
  streamlit==1.31.0
  pandas==2.1.4
  numpy==1.26.3
  openpyxl==3.1.2
  ```
- **功能**: 安装Python依赖包

### 3. packages.txt
- **大小**: 18字节
- **内容**:
  ```
  r-base
  r-base-dev
  ```
- **功能**: 安装R语言环境

### 4. install_r_packages.R
- **大小**: ~380字节
- **内容**: R包安装脚本
- **功能**: 安装MALDIquant、MALDIquantForeign、readxl

### 5. README.md
- **大小**: ~1KB
- **内容**: 项目说明文档
- **功能**: 在GitHub显示项目介绍

---

## ✅ 验证清单

上传完成后，检查：

- [ ] 仓库中有5个文件
- [ ] 文件名完全一致（注意大小写）
- [ ] 点击每个文件都能看到内容
- [ ] 仓库设置为Public
- [ ] README.md正常显示

---

## 🎯 应用功能

### 核心功能

1. **阶段1: 建立训练集模版**
   - 上传训练集ZIP（TXT + Excel）
   - 自动处理并建立特征模版
   - 下载训练集结果和模版

2. **阶段2: 处理验证集**
   - 上传验证集ZIP（只需TXT）
   - 使用训练集模版提取强度
   - 下载验证集结果
   - 可重复处理多批次验证集

### 关键优势

- ✅ 训练集定义特征，所有验证集使用相同特征
- ✅ 可处理无限多批次验证集
- ✅ 特征完全一致，可直接用于建模
- ✅ 处理快速（验证集无需重新检峰）
- ✅ 模型稳定可复现

---

## 📊 处理流程

```
训练集 (1219个TXT + Excel)
    ↓
建立特征模版 (285个m/z)
    ↓
保存特征模版
    ↓
验证集1 → 使用模版提取 → 输出 (285个特征) ✅
验证集2 → 使用模版提取 → 输出 (285个特征) ✅
验证集3 → 使用模版提取 → 输出 (285个特征) ✅
验证集N → 使用模版提取 → 输出 (285个特征) ✅
```

**结果**: 所有数据集特征完全一致！

---

## 🔧 技术栈

- **前端**: Streamlit (Python)
- **后端处理**: R + MALDIquant
- **部署平台**: Streamlit Cloud
- **文件处理**: Python zipfile, pandas

---

## ⚠️ 重要提示

### 1. R环境安装时间

首次部署需要5-10分钟安装R环境和包，这是正常的。

### 2. 文件大小限制

- 单个ZIP文件: < 200MB
- 建议训练集: < 50MB
- 验证集: < 50MB

### 3. 处理时间

- 训练集 (1219个样本): 约5-10分钟
- 验证集 (763个样本): 约3-5分钟

### 4. Excel格式要求

必须包含两列：
- `file`: TXT文件名
- `group`: 分组标签

---

## 📞 故障排除

### 问题1: 部署失败

**检查**:
- 是否所有文件都上传了？
- 文件名是否正确（大小写）？
- 仓库是否为Public？

### 问题2: R环境错误

**解决**:
- 检查packages.txt是否正确
- 检查install_r_packages.R是否存在
- 查看Streamlit Cloud日志

### 问题3: 处理超时

**解决**:
- 减少样本数量
- 调整参数（提高SNR阈值）
- 等待更长时间

---

## 🎉 成功标志

部署成功后，你应该看到：

1. ✅ 网页界面正常显示
2. ✅ 有两个标签页：
   - "阶段1: 建立训练集模版"
   - "阶段2: 处理验证集"
3. ✅ 侧边栏显示"R环境已安装"
4. ✅ 可以上传ZIP文件

---

## 📚 相关文档

- Streamlit文档: https://docs.streamlit.io/
- MALDIquant文档: https://cran.r-project.org/web/packages/MALDIquant/
- Streamlit Cloud部署: https://docs.streamlit.io/streamlit-community-cloud

---

**祝你部署成功！开始使用MALDI-TOF MS模版化处理平台吧！** 🎊
